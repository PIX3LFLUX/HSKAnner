<!DOCTYPE html>
<html lang="en-GB"><head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, user-scalable=no">
    <title>Pi 4 Bootloader Configuration - Raspberry Pi Documentation</title>
    <meta name="description" content="This section contains documentation with technical information about the Raspberry Pi hardware, including official add-ons and the Pi itself.">
    <link rel="icon" type="image/png" href="https://www.raspberrypi.org/app/themes/mind-control/images/favicon.png">
    <link rel="publisher" href="https://plus.google.com/+RaspberryPi">
    <link rel="preconnect stylesheet" href="Pi%204%20Bootloader%20Configuration%20-%20Raspberry%20Pi%20Documentation_files/css.css" media="all" type="text/css">
    <link rel="stylesheet" href="Pi%204%20Bootloader%20Configuration%20-%20Raspberry%20Pi%20Documentation_files/legacy.css">
    <link rel="stylesheet" href="Pi%204%20Bootloader%20Configuration%20-%20Raspberry%20Pi%20Documentation_files/prism.css">
    <script type="text/javascript" async="" src="Pi%204%20Bootloader%20Configuration%20-%20Raspberry%20Pi%20Documentation_files/ga.js"></script><script src="Pi%204%20Bootloader%20Configuration%20-%20Raspberry%20Pi%20Documentation_files/jquery.js"></script>
    <script src="Pi%204%20Bootloader%20Configuration%20-%20Raspberry%20Pi%20Documentation_files/prism.js"></script>

    <script type="text/javascript">//<![CDATA[
        var _gaq = _gaq || [];
        _gaq.push(['_setAccount', 'UA-46270871-1']);
        _gaq.push(['_trackPageview']);
        (function () {
            var ga = document.createElement('script');
            ga.type = 'text/javascript';
            ga.async = true;
            ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';

            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(ga, s);
        })();
        //]]></script>

    <link rel="canonical" href="https://www.raspberrypi.org/">
    <link rel="shortlink" href="https://www.raspberrypi.org/">
</head>

<body class="documentation">
    <header class="o-header">
        <nav class="o-container o-header__container">
            <a class="o-header__home-link" href="https://www.raspberrypi.org/">
                <span class="u-visually-hidden">Home</span>
            </a>

            <div class="o-header__nav">
                <ul class="c-nav">
                                            <li class="c-nav__item">
                            <a class="c-nav__link c-nav__link--products" href="https://www.raspberrypi.org/products/">
                                Products                            </a>
                        </li>
                                            <li class="c-nav__item">
                            <a class="c-nav__link c-nav__link--blog" href="https://www.raspberrypi.org/blog/">
                                Blog                            </a>
                        </li>
                                            <li class="c-nav__item">
                            <a class="c-nav__link c-nav__link--downloads" href="https://www.raspberrypi.org/downloads/">
                                Downloads                            </a>
                        </li>
                                            <li class="c-nav__item">
                            <a class="c-nav__link c-nav__link--community" href="https://www.raspberrypi.org/community/">
                                Community                            </a>
                        </li>
                                            <li class="c-nav__item">
                            <a class="c-nav__link c-nav__link--help" href="https://www.raspberrypi.org/help/">
                                Help                            </a>
                        </li>
                                            <li class="c-nav__item">
                            <a class="c-nav__link c-nav__link--forums" href="https://www.raspberrypi.org/forums/">
                                Forums                            </a>
                        </li>
                                            <li class="c-nav__item">
                            <a class="c-nav__link c-nav__link--education" href="https://www.raspberrypi.org/education/">
                                Education                            </a>
                        </li>
                                            <li class="c-nav__item">
                            <a class="c-nav__link c-nav__link--projects" href="https://projects.raspberrypi.org/?ref=nav">
                                Projects                            </a>
                        </li>
                                    </ul>
            </div>

            <div class="o-header__spacer"></div>

            <div class="o-header__search-toggle">
                <span aria-hidden="true" class="c-search-toggle">
                    <span class="u-visually-hidden">Open Search Input</span>
                </span>
            </div>

            <div class="o-header__toggle">
                <span aria-hidden="true" class="c-nav-toggle">
                    <span class="c-nav-toggle__icon">
                        <span class="c-nav-toggle__icon-inner">
                            <span class="u-visually-hidden">Open Navigation</span>
                        </span>
                    </span>
                </span>
            </div>
        </nav>
    </header>

    <div class="o-header__search">
        <form action="/" class="c-search" role="search" method="GET">
            <div class="o-container c-search__container">
                <input type="search" class="c-search__input" placeholder="Search Raspberry Pi" name="s">
                <button class="c-search__submit">Search</button>
            </div>
        </form>
    </div>

    <script>
        var header = document.querySelector('.o-header')
        var navToggle = document.querySelector('.c-nav-toggle')

        navToggle.addEventListener('click', function (event) {
            event.preventDefault()

            header.classList.toggle('o-header--nav-open')

            document.querySelector('.c-nav-toggle__icon').classList.toggle('c-nav-toggle__icon--open')
            document.querySelector('.c-nav-toggle__icon-inner').classList.toggle('c-nav-toggle__icon-inner--open')
        })

        var searchToggle = document.querySelector('.c-search-toggle')

        searchToggle.addEventListener('click', function (event) {
            event.preventDefault()

            var searchContainer = document.querySelector('.o-header__search')
            var searchInput = document.querySelector('.c-search__input')

            searchInput.blur()
            searchToggle.classList.toggle('c-search-toggle--open')
            searchContainer.classList.toggle('o-header__search--open')

            if (searchContainer.classList.contains('o-header__search--open')) {
                searchInput.focus()
            }
        })
    </script>

    <div class="container">
        <div class="main">

<nav class="breadcrumbs">
    <a href="https://www.raspberrypi.org/documentation">documentation</a> &gt; <a href="https://www.raspberrypi.org/documentation/hardware">hardware</a> &gt; <a href="https://www.raspberrypi.org/documentation/hardware/raspberrypi">raspberrypi</a> &gt; bcm2711_bootloader_config</nav>

<article class="entry-content">
    <h1>Pi 4 Bootloader Configuration</h1>
<p>You can display the currently-active configuration using </p>
<pre><code>vcgencmd bootloader_config</code></pre>
<p>To change these bootloader configuration items, you need to extract 
the configuration segment, make changes, re-insert it, then reprogram 
the EEPROM with the new bootloader. The Raspberry Pi will need to be 
rebooted for changes to take effect. </p>
<pre><code># Copy the EEPROM image of interest from /lib/firmware/raspberrypi/bootloader/ to pieeprom.bin
rpi-eeprom-config pieeprom.bin &gt; bootconf.txt

# Edit the configuration using a text editor e.g. nano bootconf.txt

# Example change. If you have a UART cable then setting BOOT_UART=1 will help debug boot issues
BOOT_UART=1

# Save the new configuration and exit editor

# Apply the configuration change to the EEPROM image file
rpi-eeprom-config --out pieeprom-new.bin --config bootconf.txt pieeprom.bin</code></pre>
<p>To update the bootloader EEPROM with the edited bootloader:</p>
<pre><code># Flash the bootloader EEPROM
# Run 'rpi-eeprom-update -h' for more information
sudo rpi-eeprom-update -d -f ./pieeprom-new.bin
sudo reboot</code></pre>
<h3>Subsequent Bootloader Updates</h3>
<p>If you update your bootloader via apt, then any configuration changes
 made using the process described here will be migrated to the updated 
bootloader.</p>
<h2>Configuration Properties</h2>
<p>This section describes all the configuration items available in the bootloader. The syntax is the same as <a href="https://www.raspberrypi.org/documentation/configuration/config-txt/">config.txt</a> but the properties are specific to the bootloader. <a href="https://www.raspberrypi.org/documentation/configuration/config-txt/conditional.md">Conditional filters</a> are also supported except for EDID.</p>
<h3>BOOT_UART</h3>
<p>If 1 then enable UART debug output on GPIO 14 and 15. Configure the 
receiving debug terminal at 115200bps, 8 bits, no parity bits, 1 stop 
bit. 
Default: 0<br>
Version: All  </p>
<h3>WAKE_ON_GPIO</h3>
<p>If 1 then 'sudo halt' will run in a lower power mode until either GPIO3 or GLOBAL_EN are shorted to ground.  </p>
<p>Default: 0 in original version of bootloader (2019-05-10). Newer bootloaders have this set to 1.<br>
Version: All  </p>
<h3>POWER_OFF_ON_HALT</h3>
<p>If 1 and WAKE_ON_GPIO=0 then switch off all PMIC outputs in halt. 
This is lowest possible power state for halt but may cause problems with
 some HATs because 5V will still be on. GLOBAL_EN must be shorted to 
ground to boot.  </p>
<p>Default: 0<br>
Version: 2019-07-15  </p>
<h3>FREEZE_VERSION</h3>
<p>If 1 then the <code>rpi-eeprom-update</code> will skip automatic 
updates on this board. The parameter is not processed by the EEPROM 
bootloader or recovery.bin since there is no way in software of fully 
write protecting the EEPROM. Custom EEPROM update scripts must also 
check for this flag.</p>
<p>Default: 0<br>
Version: All  </p>
<h3>BOOT_ORDER</h3>
<p>The BOOT_ORDER setting allows flexible configuration for the priority
 of different bootmodes. It is represented as 32bit unsigned integer 
where each nibble represents a bootmode. The bootmodes are attempted in 
lowest significant nibble to highest significant nibble order.</p>
<p>E.g. 0x21 means try SD first followed by network boot then stop. 
Whereas 0x2 would mean try network boot and then stop without trying to 
boot from the SD card.</p>
<p>The retry counters are reset when switching to the next boot mode.</p>
<p>BOOT_ORDER fields<br>
The BOOT_ORDER property defines the sequence for the different boot 
modes. It is read right to left and up to 8 digits may be defined.</p>
<ul>
<li>0x0 - NONE (stop with error pattern)  </li>
<li>0x1 - SD CARD  </li>
<li>0x2 - NETWORK  </li>
<li>0x3 - USB device boot <a href="https://github.com/raspberrypi/usbboot">usbboot</a> - Compute Module only.</li>
<li>0x4 - USB mass storage boot</li>
<li>0xf - RESTART (loop) - start again with the first boot order field.</li>
</ul>
<p>Default: 0x1<br>
Version: pieeprom-2020-04-16.bin  </p>
<ul>
<li>Boot mode 0x0 will retry the SD boot if the SD card detect pin indicates that the card has been inserted or replaced.</li>
<li>The default boot mode is now 0xf41 which means continuously try SD then USB mass storage.</li>
</ul>
<h3>MAX_RESTARTS</h3>
<p>If the RESTART (0xf) boot mode is encountered more than MAX_RESTARTS 
times then a watchdog reset is triggered. This isn't recommended for 
general use but may be useful for test or remote systems where a full 
reset is needed to resolve issues with hardware or network interfaces.</p>
<p>Default: -1 (infinite)<br>
Version: pieeprom-2020-06-15.bin - STABLE  </p>
<h3>SD_BOOT_MAX_RETRIES</h3>
<p>The number of times that SD boot will be retried after failure before moving to the next boot mode defined by <code>BOOT_ORDER</code>.<br>
-1 means infinite retries. <br>
Default: 0<br>
Version: pieeprom-2020-04-16.bin  </p>
<h3>NET_BOOT_MAX_RETRIES</h3>
<p>The number of times that network boot will be retried after failure before moving to the next boot mode defined by <code>BOOT_ORDER</code>.<br>
-1 means infinite retries.  <br>
Default: 0<br>
Version: pieeprom-2020-04-16.bin  </p>
<h3>DHCP_TIMEOUT</h3>
<p>The timeout in milliseconds for the entire DHCP sequence before failing the current iteration.<br>
Default: 45000<br>
Minimum: 5000<br>
Version: pieeprom-2020-04-16.bin  </p>
<h3>DHCP_REQ_TIMEOUT</h3>
<p>The timeout in milliseconds before retrying DHCP DISCOVER or DHCP REQ.<br>
Default: 4000<br>
Minimum: 500<br>
Version: pieeprom-2020-04-16.bin  </p>
<h3>TFTP_FILE_TIMEOUT</h3>
<p>The timeout in milliseconds for an individual file download via TFTP.<br>
Default: 30000<br>
Minimum: 5000<br>
Version: pieeprom-2020-04-16.bin  </p>
<h3>TFTP_IP</h3>
<p>Optional dotted decimal ip address (e.g. "192.168.1.99") for the TFTP
 server which overrides the server-ip from the DHCP request.<br>
This maybe useful on home networks because tftpd-hpa can be used instead of dnsmasq where broadband router is the DHCP server.</p>
<p>Default: ""<br>
Version: pieeprom-2020-04-16.bin  </p>
<h3>TFTP_PREFIX</h3>
<p>In order to support unique TFTP boot directories for each Pi the 
bootloader prefixes the filenames with a device specific directory. If 
neither start4.elf nor start.elf are found in the prefixed directory 
then the prefix is cleared.
On earlier models the serial number is used as the prefix, however, on 
Pi 4 the MAC address is no longer generated from the serial number 
making it difficult to automatically create tftpboot directories on the 
server by inspecting DHCPDISCOVER packets. To support this the 
TFTP_PREFIX may be customized to either be the MAC address, a fixed 
value or the serial number (default).</p>
<ul>
<li>0 - Use the serial number e.g. "9ffefdef/"</li>
<li>1 - Use the string specified by TFTP_PREFIX_STR</li>
<li>2 - Use the MAC address e.g. "dc-a6-32-01-36-c2/"</li>
</ul>
<p>Default: 0<br>
Version: pieeprom-2020-04-16.bin  </p>
<h3>TFTP_PREFIX_STR</h3>
<p>Specify the custom directory prefix string used when TFTP_PREFIX is set to 1. For example:- TFTP_PREFIX_STR=tftp_test/
Default: ""<br>
Version: pieeprom-2020-04-16.bin  </p>
<h3>PXE_OPTION43</h3>
<p>Overrides the PXE Option43 match string with a different string. It's
 normally better to apply customisations to the DHCP server than change 
the client behaviour but this option is provided in case that's not 
possible.
Default: "Raspberry Pi Boot"<br>
Version: pieeprom-2020-04-16.bin  </p>
<h3>DHCP_OPTION97</h3>
<p>In earlier releases the client GUID (Option97) was just the serial 
number repeated 4 times. By default, the new GUID format is
the concatenation of the fourcc for RPi4 (0x34695052 - little endian), 
the board revision (e.g. 0x00c03111) (4-bytes), the least significant 4 
bytes of the mac address and the 4-byte serial number.
This is intended to be unique but also provide structured information to
 the DHCP server, allowing Raspberry Pi4 computers to be identified 
without relying upon the Ethernet MAC OUID.</p>
<p>Specify DHCP_OPTION97=0 to revert the the old behaviour or a non-zero hex-value to specify a custom 4-byte prefix.</p>
<p>Default: 0x34695052<br>
Version: pieeprom-2020-04-16.bin  </p>
<h3>Static IP address configuration</h3>
<p>If TFTP_IP and the following options are set then DHCP is skipped and
 the static IP configuration is applied. If the TFTP server is on the 
same subnet as the client then GATEWAY may be omitted.</p>
<h4>CLIENT_IP</h4>
<p>The IP address of the client e.g. "192.168.0.32" <br>
Default: ""<br>
Version: pieeprom-2020-04-16.bin  </p>
<h4>SUBNET</h4>
<p>The subnet address mask e.g. "255.255.255.0" <br>
Default: ""<br>
Version: pieeprom-2020-04-16.bin  </p>
<h4>GATEWAY</h4>
<p>The gateway address to use if the TFTP server is on a differenet subnet e.g. "192.168.0.1"
Default: ""<br>
Version: pieeprom-2020-04-16.bin  </p>
<h4>MAC_ADDRESS</h4>
<p>Overrides the Ethernet MAC address with the given value. e.g. dc:a6:32:01:36:c2<br>
Default: "" <br>
Version: pieeprom-2020-04-16.bin</p>
<h3>DISABLE_HDMI</h3>
<p>The <a href="https://www.raspberrypi.org/documentation/hardware/raspberrypi/boot_diagnostics.md">HDMI boot diagnostics</a> display is disabled if DISABLE_HDMI=1. Other non-zero values are reserved for future use.</p>
<p>Default: 0 <br>
Version: pieeprom-2020-04-16.bin  </p>
<p><code>Version: pieeprom-2020-06-15.bin - STABLE</code>
The <code>disable_splash</code> property is no longer checked because the HDMI diagnostics screen is started before config.txt is read.</p>
<h3>ENABLE_SELF_UPDATE</h3>
<p>Allows the bootloader to update itself instead of requiring 
recovery.bin. This is intended to make it easier to update the 
bootloader firmware via network boot. To enable set <code>ENABLE_SELF_UPDATE=1</code> and add <code>bootloader_update=1</code>
 in config.txt.
N.B. There is no automatic rollback in the event of a power failure 
during the firmware update. In the unlikely event of this happening you 
will have to use Pi Imager to apply the rescue image.</p>
<p>If self update is enabled then the bootloader will look for 
(pieeprom.upd + pieeprom.sig) and/or (vl805.bin + vl805.sig) on the boot
 partition (or TFTP root). If the update files are different to the 
current image then the update is applied and system is reset. Otherwise,
 if the images are identical then boot continues as normal.</p>
<p>Since the updates files are in the same format as generated by 
rpi-eeprom-update you can use rpi-eeprom-update to install the files to 
/boot so long as /boot mounts the approprate boot device / tftp-root 
(via NFS).</p>
<p><strong>The bootloader only reads the configuration from the 
bootconf.txt in the EEPROM and not the one in the update files. 
Therefore, in order to enable <code>ENABLE_SELF_UPDATE</code> you have to first update the bootloader via the SD-CARD or FLASHROM.</strong></p>
<p>Default: 0<br>
Version: pieeprom-2020-04-16.bin  </p>
<p><code>Version: pieeprom-2020-06-15.bin - STABLE</code>
The <code>ENABLE_SELF_UPDATE</code> EEPROM property and <code>bootloader_update</code> config.txt property are now enabled by default so that <code>rpi-eeprom-update</code> may be used without requiring extra customization. Setting either of these parameters to zero prevents self-updates.</p>
<h3>FREEZE_VERSION</h3>
<p>Previously this property was only checked by the rpi-eeprom-update 
script. However, now that self-update is enabled the bootloader will 
also check this property. If set, this overrides <code>ENABLE_SELF_UPDATE</code> to stop automatic updates. To disable <code>FREEZE_VERSION</code> you will have to use an SD card boot with recovery.bin.</p>
<p>Default: 0<br>
Version: pieeprom-2020-06-15.bin - STABLE  </p>
<h3>NETCONSOLE - advanced logging</h3>
<p><code>NETCONSOLE</code> duplicates debug messages to the network interface. The IP addresses and ports are defined by the <code>NETCONSOLE</code> string.</p>
<p>N.B. NETCONSOLE blocks until the ethernet link is established or a timeout occurs. The timeout value is <code>DHCP_TIMEOUT</code> although DHCP is not attempted unless network boot is requested.</p>
<h4>Format</h4>
<p>See <a href="https://wiki.archlinux.org/index.php/Netconsole">https://wiki.archlinux.org/index.php/Netconsole</a></p>
<pre><code>src_port@src_ip/dev_name,dst_port@tgt_ip/tgt_mac
E.g. 6665@169.254.1.1/eth0,6666@/</code></pre>
<p>In order to simplify parsing, the bootloader requires every field 
separator to be present. In the example the target IP address 
(255.255.255.255) and target mac address (00:00:00:00:00) are assigned 
default values.</p>
<p>One way to view the data is to connect the test Pi 4 to another Pi 
running WireShark and select “udp.srcport == 6665” as a filter and 
select <code>Analyze -&gt; Follow -&gt; UDP stream</code> to view as an ASCII log.</p>
<p><code>NETCONSOLE</code> should not be enabled by default because it may cause network problems. It can be enabled on demand via a GPIO filter e.g.</p>
<pre><code># Enable debug if GPIO 7 is pulled low
[gpio7=0]
BOOT_UART=1
NETCONSOLE=6665@169.254.1.1/eth0,6666@/</code></pre>
<p>Version: pieeprom-2020-06-15.bin - STABLE  </p>
<h3>USB_MSD_EXCLUDE_VID_PID</h3>
<p>A list of up to 4 VID/PID pairs specifying devices which the 
bootloader should ignore. If this matches a HUB then the HUB won’t be 
enumerated, causing all downstream devices to be excluded.
This is intended to allow problematic (e.g. very slow to enumerate) 
devices to be ignored during boot enumeration. This is specific to the 
bootloader and is not passed to the OS.</p>
<p>The format is a comma-separated list of hexadecimal values with the VID as most significant nibble. Spaces are not allowed.
E.g. <code>034700a0,a4231234</code></p>
<p>Default: “”<br>
Version: pieeprom-2020-06-15.bin - STABLE  </p>
<h3>USB_MSD_DISCOVER_TIMEOUT</h3>
<p>If no USB mass storage devices are found within this timeout then USB-MSD is stopped and the next boot mode is selected</p>
<p>Default: 20000 (20 seconds)<br>
Version: pieeprom-2020-06-15.bin - STABLE  </p>
<h3>USB_MSD_LUN_TIMEOUT</h3>
<p>How long to wait in milliseconds before advancing to the next LUN 
e.g. a multi-slot SD-CARD reader. This is still being tweaked but may 
help speed up boot if old/slow devices are connected as well as a fast 
USB-MSD device containing the OS.</p>
<p>Default:  2000 (2 seconds)<br>
Version: pieeprom-2020-06-15.bin - STABLE</p>
<h3>USB_MSD_PWR_OFF_TIME</h3>
<p>During USB mass storage boot, power to the USB ports is switched off 
for a short time to ensure the correct operation of USB mass storage 
devices. Most devices work correctly using the default setting: change 
this only if you have problems booting from a particular device. Setting
 <code>USB_MSD_PWR_OFF_TIME=0</code> will prevent power to the USB ports being switched off during USB mass storage boot.</p>
<p>Default: 1000 (1 second)
Minimum: 250
Maximum: 5000
Version: pieeprom-2020-06-15.bin - STABLE</p>
<h3>XHCI_DEBUG</h3>
<p>This property is a bit field which controls the verbosity of USB 
trace messages for mass storage boot mode. Enabling all of these 
messages generates a huge amount of log data which will slow down 
booting and may even cause boot to fail. For verbose logs it's best to 
use <code>NETCONSOLE</code></p>
<ul>
<li>Bit 0 - USB descriptors</li>
<li>Bit 1 - Mass storage mode state machine </li>
<li>Bit 2 - Mass storage mode state machine - verbose</li>
<li>Bit 3 - All USB requests</li>
<li>Bit 4 - Log device and hub state machines</li>
<li>Bit 5 - Log all xHCI TRBs (VERY VERBOSE)</li>
<li>Bit 6 - Log all xHCI events (VERY VERBOSE)</li>
</ul>
<p>By default, no extra debug messages are enabled. </p>
<pre><code># Example: Enable mass storage and USB descriptor logging
XHCI_DEBUG=0x3</code></pre>
<p>Default: 0x0<br>
Version: pieeprom-2020-06-15.bin - STABLE  </p>
<h2>config.txt - configuration properties</h2>
<h3>BOOT_LOAD_FLAGS</h3>
<p>Experimental property for custom firmware (bare metal).</p>
<p>Bit 0 (0x1) indicates that the .elf file is custom firmware. This 
disables any compatiblity checks (e.g. is USB MSD boot supported) and 
resets PCIe before starting the executable. </p>
<p>Default: 0x0<br>
Version: pieeprom-2020-06-15.bin - STABLE  </p>
<h2>Network Boot</h2>
<h3>Server configuration</h3>
<p>Network boot requires a TFTP and NFS server to be configured.  See <a href="https://www.raspberrypi.org/documentation/hardware/raspberrypi/bootmodes/net_tutorial.md">Network boot server tutorial</a></p>
<p>Additional notes:-</p>
<ul>
<li>The MAC address on the Pi 4 is programmed at manufacture and is not derived from the serial number.
<pre><code># mac address (ip addr) - it should start with DC:A6:32
ip addr | grep ether | head -n1 | awk '{print $2}' | tr [a-z] [A-Z]                                                                                                                                                
# serial number                                                                                                                         
vcgencmd otp_dump | grep 28: | sed s/.*://g</code></pre></li>
</ul>
<h3>Installation - firmware update</h3>
<p>Network boot is available in the latest production bootloader 
(pieeprom-2020-04-16.bin). Previous beta/stable releases which supported
 network boot are still available but are deprecated.</p>
<pre><code># Update the rpi-eeprom package                                                                                                 
sudo apt update
sudo apt upgrade
# Check the current version
sudo rpi-eeprom-update     
# Update to latest
sudo rpi-eeprom-update -a</code></pre>
<h3>Enable network boot</h3>
<p>Network boot is not enabled by default in the bootloader. To enable it the bootloader configuration file must be edited.</p>
<pre><code># Extract the configuration file                                                                                                         
cp /lib/firmware/raspberrypi/bootloader/critical/pieeprom-2020-04-16.bin pieeprom.bin                                                       
rpi-eeprom-config pieeprom.bin &gt; bootconf.txt                                                                          </code></pre>
<p>Change <code>BOOT_ORDER</code> to be <code>0x21</code> instead of <code>0x1</code>. This tells the bootloader to try sd-card boot first and network boot second. You should normally include sd-card (<code>0x1</code>) in the boot sequence in-case of network failure.</p>
<h3>Apply the configuration change to the EEPROM image file</h3>
<pre><code>rpi-eeprom-config --out pieeprom-netboot.bin --config bootconf.txt pieeprom.bin</code></pre>
<h3>Install the new EEPROM image</h3>
<pre><code>sudo rpi-eeprom-update -d -f ./pieeprom-netboot.bin
sudo reboot</code></pre>
<p><a name="usbmassstorageboot"></a></p>
<h2>USB mass storage boot</h2>
<p>This is currently undergoing beta testing and also requires updated GPU (start.elf) firmware via APT-update OR <a href="https://www.raspberrypi.org/documentation/raspbian/applications/rpi-update.md">rpi-update</a>.
 If you aren't already familiar with how to use a USB drive for the root
 filesystem then you probably want to wait until this feature is in the 
default Raspberry Pi OS image.</p>
<p>There is no support for migrating a SD card image to a USB drive. It 
is possible, but the process can potentially be quite involved and 
varies according to your original setup. Please see <a href="https://www.raspberrypi.org/forums/viewtopic.php?f=29&amp;t=44177&amp;start=350">this forum thread</a> for more information.</p>
<p>N.B. There is now a <code>stable</code> release of the bootloader 
which supports USB MSD and will only be updated with major bug fixes. 
Since the GPU firmware must also be upgraded USB-MSD boot as a feature 
is still viewed as beta software.</p>
<h2>USB-MSD firmware setup instructions</h2>
<p>These instructions assume that you are familiar with manual firmware 
and bootloader updates and understand how to revert to a previous 
version if you want to revert the changes. If not, please wait until the
 features are available in a full Raspberry Pi OS release image.</p>
<p><strong>These instructions are specific to Raspberry Pi OS. Other 
distributions including NOOBS are likely to require additional steps in 
order to enable USB boot</strong></p>
<h3>Check that the USB mass storage device works under Linux</h3>
<p>Before attempting to boot from a USB mass storage device it is 
advisible to verify that the device works correctly under Linux. Boot 
using an SD card and plug in the USB mass storage device. This should 
appears as a removable drive.</p>
<p>This is especially important with USB SATA adapters which may be 
supported by the bootloader in mass storage mode but fail if Linux 
selects <a href="https://en.wikipedia.org/wiki/USB_Attached_SCSI">USB Attached SCSI - UAS</a> mode. </p>
<p>See this <a href="https://www.raspberrypi.org/forums/viewtopic.php?t=245931">forum thread</a> about UAS and how to add <a href="https://www.kernel.org/doc/html/v5.0/admin-guide/kernel-parameters.html">usb-storage.quirks</a> to workaround this issue.</p>
<h3>Multiple bootable drives</h3>
<p>When searching for a bootable partition the bootloader scans all USB 
mass storage devices in parallel and will select the first to respond. 
If the boot partition does not contain a suitable start.elf file the 
next available device is selected.</p>
<p>As with earlier Raspberry Pi models there is no method for specifying
 the boot device according to the USB topology because this would slow 
down boot and adds unecessary and hard to support configuration 
complexity.</p>
<p>N.B. config.txt <a href="https://www.raspberrypi.org/documentation/hardware/configuration/config-txt/conditional.md">conditional filters</a> can be used to select alternate firmware in complex device configurations.</p>
<h3>Update the bootloader</h3>
<ul>
<li>
<p>From a standard Raspberry Pi OS SD card boot:</p>
<pre><code>sudo apt update
sudo apt full-upgrade</code></pre>
</li>
<li>
<p>As root, edit <code>/etc/default/rpi-eeprom-update</code> and select <code>stable</code> releases.</p>
</li>
<li>
<p>Install the <code>stable</code> version of the bootloader and replace the current configuration settings to enable USB boot.
See <code>BOOT_ORDER</code> property if you wish to migrate the configuration by hand.</p>
<pre><code>sudo rpi-eeprom-update -d -f /lib/firmware/raspberrypi/bootloader/stable/pieeprom-2020-06-15.bin</code></pre>
<p>Alternatively, use the Raspberry Pi Imager to create a custom SD card from the lastest MSD STABLE image on the <a href="https://github.com/raspberrypi/rpi-eeprom/blob/master/releases.md">releases</a> page.</p>
</li>
<li>Reboot and check the bootloader version and config:
<pre><code>vcgencmd bootloader_version 
vcgencmd bootloader_config</code></pre></li>
</ul>
<h3>Create a bootable USB drive</h3>
<ul>
<li>Use the <a href="https://www.raspberrypi.org/downloads/">Raspberry Pi Imager</a>
 to flash Raspberry Pi OS to a USB mass storage device. Other distros 
have not been tested and may require updates (e.g. u-boot). One reason 
for having a public beta is to help get USB MSD boot support into other 
distros.</li>
<li>Update the GPU firmware via APT <code>sudo apt update</code> then <code>sudo apt full-upgrade</code></li>
<li>Download the updated firmware files <code>*.elf *.dat</code> from the <code>master</code> branch of the <a href="https://github.com/raspberrypi/firmware">Raspberry Pi Firmware</a> Github repo. </li>
<li>Alternatively use <code>sudo rpi-update</code> to update the firmware on a Raspberry Pi OS SD card install, then copy the files from there.</li>
<li>Copy these updates to the boot partition on the USB device. From now on <code>sudo rpi-update</code> can be used from within Raspberry Pi OS on the USB boot device.</li>
<li>A Linux kernel update is not required. Raspberry Pi OS has been tested using the 4.19 and 5.4 (32 and 64 bit) kernel.</li>
</ul>
<h3>USB device compatiblity</h3>
<p>There is no explicit set of supported devices. Initially we recommend
 using a USB pen drive or SSD. Hard drives will probably require a 
powered HUB and in all cases you should verify that the devices work 
correctly from within Raspberry Pi OS using an SD card boot.</p>
<p>Please post interoperability reports (positive or negative) on <a href="https://www.raspberrypi.org/forums/viewtopic.php?f=63&amp;t=274595">this thread</a> on the Raspberry Pi forums. </p></article>

                <footer class="licence">
                    <aside class="octocat">
                        <a href="https://github.com/raspberrypi/documentation/blob/master/hardware/raspberrypi/bcm2711_bootloader_config.md"><img src="Pi%204%20Bootloader%20Configuration%20-%20Raspberry%20Pi%20Documentation_files/octocat.jpg"></a>
                    </aside>
                    <aside class="links">
                        <a href="https://github.com/raspberrypi/documentation/blob/master/hardware/raspberrypi/bcm2711_bootloader_config.md" class="github">View/Edit this page on GitHub</a><br>
                        <a href="https://www.raspberrypi.org/creative-commons/">Read our usage and contributions policy</a><br>
                        <a href="https://www.raspberrypi.org/creative-commons/" class="cc"><img src="Pi%204%20Bootloader%20Configuration%20-%20Raspberry%20Pi%20Documentation_files/88x31.png" alt="Creative Commons Licence"></a>
                    </aside>
                </footer>

                <div style="clear: both;"></div>

            </div>

        <div style="clear: both;"></div>
    </div>

    <footer class="o-footer">
        <div class="o-footer__slice">
            <div class="o-container o-footer__container">
                <div class="o-footer__nav">
                    <div class="c-footer-nav">
                        <span class="c-footer-nav__title">About Us</span>

                        <ul class="c-footer-nav__list">
                            <li class="c-footer-nav__item">
                                <a class="c-footer-nav__link" href="https://www.raspberrypi.org/about">About us</a>
                            </li>
                            <li class="c-footer-nav__item">
                                <a class="c-footer-nav__link" href="https://www.raspberrypi.org/about/meet-the-team">Our team</a>
                            </li>
                            <li class="c-footer-nav__item">
                                <a class="c-footer-nav__link" href="https://www.raspberrypi.org/about/governance">Governance</a>
                            </li>
                            <li class="c-footer-nav__item">
                                <a class="c-footer-nav__link" href="https://www.raspberrypi.org/safeguarding">Safeguarding</a>
                            </li>
                            <li class="c-footer-nav__item">
                                <a class="c-footer-nav__link" href="https://www.raspberrypi.org/about/supporters">Our supporters</a>
                            </li>
                            <li class="c-footer-nav__item">
                                <a class="c-footer-nav__link" href="https://raspberrypi.workable.com/">Jobs</a>
                            </li>
                            <li class="c-footer-nav__item">
                                <a class="c-footer-nav__link" href="https://www.raspberrypi.org/contact">Contact us</a>
                            </li>
                        </ul>
                    </div>
                </div>

                <div class="o-footer__nav">
                    <div class="c-footer-nav">
                        <span class="c-footer-nav__title">Support</span>

                        <ul class="c-footer-nav__list">
                            <li class="c-footer-nav__item">
                                <a class="c-footer-nav__link" href="https://www.raspberrypi.org/help">Help</a>
                            </li>
                            <li class="c-footer-nav__item">
                                <a class="c-footer-nav__link" href="https://www.raspberrypi.org/documentation">Documentation</a>
                            </li>
                            <li class="c-footer-nav__item">
                                <a class="c-footer-nav__link" href="https://projects.raspberrypi.org/">Projects</a>
                            </li>
                            <li class="c-footer-nav__item">
                                <a class="c-footer-nav__link" href="https://www.raspberrypi.org/training">Training</a>
                            </li>
                            <li class="c-footer-nav__item">
                                <a class="c-footer-nav__link" href="https://www.raspberrypi.org/downloads">Downloads</a>
                            </li>
                            <li class="c-footer-nav__item">
                                <a class="c-footer-nav__link" href="https://www.raspberrypi.org/research-and-insights">Research</a>
                            </li>
                            <li class="c-footer-nav__item">
                                <a class="c-footer-nav__link" href="https://www.raspberrypi.org/help/faqs">FAQ</a>
                            </li>
                        </ul>
                    </div>
                </div>

                <div class="o-footer__newsletter">
                    <form action="https://raspberrypi.hosted.phplist.com/lists/?p=subscribe&amp;id=1" class="c-footer-newsletter" method="POST">
                        <span class="c-footer-newsletter__legend">
                            Sign up to our newsletter
                        </span>
                        <input class="c-footer-newsletter__input" name="email" placeholder="Your email here" required="" type="email">
                        <input type="hidden" name="htmlemail" value="1">
                        <input type="hidden" name="list[3]" value="signup">
                        <input type="hidden" name="listname[3]" value="Raspberry Pi Weekly">
                        <input class="c-footer-newsletter__input--verification-code" type="text" name="VerificationCodeX" size="20">
                        <button class="c-footer-newsletter__button" name="subscribe">
                            Subscribe
                        </button>
                    </form>
                </div>

                <div class="o-footer__info">
                    <ul class="c-footer-social">
                        <li class="c-footer-social__item">
                            <a class="c-footer-social__link c-footer-social__link--facebook" href="https://www.facebook.com/raspberrypi">
                                <span class="u-visually-hidden">Like Raspberry Pi on Facebook</span>
                            </a>
                        </li>
                        <li class="c-footer-social__item">
                            <a class="c-footer-social__link c-footer-social__link--twitter" href="https://twitter.com/Raspberry_Pi">
                                <span class="u-visually-hidden">Follow Raspberry Pi on Twitter</span>
                            </a>
                        </li>
                        <li class="c-footer-social__item">
                            <a class="c-footer-social__link c-footer-social__link--instagram" href="https://www.instagram.com/raspberrypi/">
                                <span class="u-visually-hidden">Check out what we’re having for lunch on Instagram</span>
                            </a>
                        </li>
                        <li class="c-footer-social__item">
                            <a class="c-footer-social__link c-footer-social__link--youtube" href="https://youtube.com/raspberrypi">
                                <span class="u-visually-hidden">Subscribe to the Raspberry Pi YouTube channel</span>
                            </a>
                        </li>
                    </ul>

                    <p class="c-footer-charity">
                        Raspberry Pi Foundation<br>
                        UK Registered Charity 1129409
                    </p>

                    <p class="c-footer-additional">
                        <a class="c-footer-additional__link" href="https://www.raspberrypi.org/privacy">Privacy</a>
                        <a class="c-footer-additional__link" href="https://www.raspberrypi.org/cookies">Cookies</a>
                        <a class="c-footer-additional__link" href="https://www.raspberrypi.org/trademark-rules">Trademark rules and brand guidelines</a>
                    </p>
                </div>
            </div>
        </div>
    </footer>


</body></html>